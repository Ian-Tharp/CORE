<div
  class="agent-card"
  [class]="'category-' + agent.category + ' status-' + getAgentStatus()"
  tabindex="0"
  role="button"
  (click)="onSelect()"
  (keydown.enter)="onSelect()"
  (keydown.space)="$event.preventDefault(); onSelect()">

  <!-- Status Aura -->
  <div class="status-aura" [class]="'aura-' + getAgentStatus()"></div>

  <!-- Top Right Actions (Always Visible) -->
  <div class="card-actions">
    <button
      mat-icon-button
      (click)="onToggleFavorite($event)"
      [matTooltip]="agent.favorite ? 'Unfavorite' : 'Favorite'"
      class="action-btn favorite-btn"
      [class.active]="agent.favorite">
      <mat-icon>{{ agent.favorite ? 'favorite' : 'favorite_border' }}</mat-icon>
    </button>

    <button
      mat-icon-button
      (click)="onToggleEnabled($event)"
      [matTooltip]="agent.enabled ? 'Disable' : 'Enable'"
      class="action-btn toggle-btn"
      [class.active]="agent.enabled">
      <mat-icon>{{ agent.enabled ? 'toggle_on' : 'toggle_off' }}</mat-icon>
    </button>

    <button
      mat-icon-button
      [matMenuTriggerFor]="menu"
      (click)="$event.stopPropagation()"
      matTooltip="More actions"
      class="action-btn menu-btn">
      <mat-icon>more_vert</mat-icon>
    </button>

    <mat-menu #menu="matMenu" class="agent-menu">
      <button mat-menu-item (click)="onExport($event)">
        <mat-icon>download</mat-icon>
        <span>Export</span>
      </button>
      <button mat-menu-item (click)="onDuplicate($event)">
        <mat-icon>content_copy</mat-icon>
        <span>Duplicate</span>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="onDelete($event)" class="delete-action">
        <mat-icon>delete</mat-icon>
        <span>Delete</span>
      </button>
    </mat-menu>
  </div>

  <!-- Category Icon with Organic Status -->
  <div class="agent-icon-container">
    <div class="icon-background" [class]="'bg-' + agent.category"></div>
    <mat-icon class="agent-icon">{{ getCategoryIcon() }}</mat-icon>
    <div class="status-pulse" [class]="'pulse-' + getAgentStatus()"></div>
  </div>

  <!-- Agent Identity -->
  <div class="agent-identity">
    <h3 class="agent-name">{{ agent.displayName }}</h3>
    <div class="agent-status-line">
      <span class="status-text">{{ getStatusText() }}</span>
      @if (agent.instances > 0) {
        <span class="workflow-count">
          <mat-icon>account_tree</mat-icon>
          {{ agent.instances }} workflow{{ agent.instances === 1 ? '' : 's' }}
        </span>
      }
    </div>
  </div>

  <!-- Capabilities & Efficiency -->
  <div class="agent-metrics">
    <div class="capabilities">
      @for (cap of getTopCapabilities(); track cap) {
        <div class="capability-badge" [matTooltip]="cap.description">
          <mat-icon>{{ cap.icon }}</mat-icon>
        </div>
      }
    </div>
    @if (agent.energyEfficient) {
      <div class="efficiency-badge" matTooltip="Energy Efficient">
        <mat-icon>eco</mat-icon>
      </div>
    }
  </div>

  <!-- Health Indicator -->
  <div class="health-bar">
    <div class="health-fill" [style.width.%]="getHealthPercentage()"></div>
    <div class="health-label">{{ getHealthPercentage() }}% health</div>
  </div>

  <!-- Description -->
  <p class="agent-description">{{ agent.description }}</p>

  <!-- Tags (compact) -->
  @if (agent.tags.length > 0) {
    <div class="tag-row">
      @for (tag of agent.tags.slice(0, 2); track tag) {
        <span class="tag-pill" (click)="onTag($event, tag)">{{ tag }}</span>
      }
      @if (agent.tags.length > 2) {
        <span class="tag-more">+{{ agent.tags.length - 2 }}</span>
      }
    </div>
  }

  <!-- Click Hint -->
  <div class="click-hint">
    <mat-icon>info</mat-icon>
    <span>Click to view details</span>
  </div>
</div>


