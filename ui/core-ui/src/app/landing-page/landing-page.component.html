<div class="landing-container">
  <!-- Loading Overlay -->
  @if (dashboardState.loading) {
    <div class="loading-overlay">
      <mat-spinner diameter="48"></mat-spinner>
      <span>Initializing Dashboard...</span>
    </div>
  }

  <!-- Error Banner -->
  @if (dashboardState.error) {
    <div class="error-banner">
      <mat-icon>error_outline</mat-icon>
      <span>{{ dashboardState.error }}</span>
      <button mat-button (click)="dashboardState.error = null">Dismiss</button>
    </div>
  }

  <!-- In-page Main Navigation Tabs -->
  <mat-tab-group class="main-tabs" selectedIndex="0">
      <mat-tab label="Dashboard">
      <!-- Three-column responsive layout -->
      <div class="content-layout">
        <!-- Chat / Assistant column -->
        <aside class="chat-section">
          <app-chat-window></app-chat-window>
        </aside>

        <!-- Central main content column -->
        <main class="main-section">
          <!-- Hero Section -->
          <section class="hero-section">
            <div class="hero-content">
              <div class="welcome-message">
                <h1 class="hero-title">
                  Welcome to <span class="core-highlight">C.O.R.E.</span>
                </h1>
                <p class="hero-subtitle">
                  Your Digital Brain Platform is operational and ready to revolutionize your AI interaction experience.
                </p>
                <div class="hero-actions">
                  <button mat-raised-button class="primary-action" (click)="scrollToDeployPanel()">
                    <mat-icon>rocket_launch</mat-icon>
                    Deploy New Agent
                  </button>
                  <button mat-stroked-button class="secondary-action" [routerLink]="['/command-center']">
                    <mat-icon>dashboard</mat-icon>
                    View Command Center
                  </button>
                  <button mat-stroked-button class="secondary-action" (click)="viewAnalytics()">
                    <mat-icon>analytics</mat-icon>
                    Analytics
                  </button>
                </div>
              </div>
              
              <!-- System Status Hologram -->
              <div class="status-hologram">
                <div class="hologram-ring outer-ring"></div>
                <div class="hologram-ring middle-ring"></div>
                <div class="hologram-ring inner-ring"></div>
                <div class="hologram-core">
                  <mat-icon class="core-icon">memory</mat-icon>
                  <div class="status-text" [style.color]="getSystemHealthColor()">
                    {{ systemHealth?.status?.toUpperCase() || 'INITIALIZING' }}
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Dashboard Grid -->
          <section class="dashboard-grid">
            <!-- Active Agents Card -->
            <mat-card class="dashboard-card agents-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>smart_toy</mat-icon>
                  Active Agents ({{ activeAgents.length }})
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="agent-grid">
                  @for (agent of activeAgents; track agent.id) {
                    <div class="agent-unit-card" [class]="agent.status">
                      <div class="agent-header">
                        <div class="agent-name">{{ agent.agent_id }}</div>
                        <mat-chip class="agent-status" [class]="agent.status">
                          {{ getAgentStatusText(agent.status) }}
                        </mat-chip>
                      </div>
                      <div class="agent-role">{{ agent.agent_role }}</div>
                      <div class="agent-stats">
                        <div class="stat-item">
                          <mat-icon>access_time</mat-icon>
                          <span>{{ agent.uptimeFormatted || 'Starting...' }}</span>
                        </div>
                        @if (agent.current_task) {
                          <div class="stat-item">
                            <mat-icon>task</mat-icon>
                            <span>{{ agent.current_task }}</span>
                          </div>
                        }
                      </div>
                      <div class="agent-actions">
                        <button mat-icon-button class="agent-btn" matTooltip="Restart"
                                (click)="restartAgent(agent)">
                          <mat-icon>refresh</mat-icon>
                        </button>
                        <button mat-icon-button class="agent-btn" matTooltip="Stop"
                                (click)="stopAgent(agent)">
                          <mat-icon>stop</mat-icon>
                        </button>
                      </div>
                    </div>
                  }
                  @empty {
                    <div class="empty-state">
                      <mat-icon>smart_toy</mat-icon>
                      <p>No agents running. Deploy one to get started.</p>
                    </div>
                  }
                </div>
                <div class="agents-footer deploy-panel">
                  <div class="deploy-form">
                    <mat-select [(value)]="selectedAgentRole" placeholder="Select Role">
                      @for (role of availableRoles; track role) {
                        <mat-option [value]="role">{{ role | titlecase }}</mat-option>
                      }
                    </mat-select>
                    <button mat-raised-button class="add-agent-btn" 
                            (click)="deployAgent()"
                            [disabled]="deploymentLoading">
                      @if (deploymentLoading) {
                        <mat-spinner diameter="18"></mat-spinner>
                      } @else {
                        <mat-icon>add</mat-icon>
                      }
                      Deploy Agent
                    </button>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>

            <!-- Task Summary Card -->
            @if (taskSummary) {
              <mat-card class="dashboard-card tasks-card">
                <mat-card-header>
                  <mat-card-title>
                    <mat-icon>assignment</mat-icon>
                    Task Overview
                  </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <div class="task-stats-grid">
                    <div class="task-stat">
                      <span class="task-count queued">{{ taskSummary.queued }}</span>
                      <span class="task-label">Queued</span>
                    </div>
                    <div class="task-stat">
                      <span class="task-count running">{{ taskSummary.running }}</span>
                      <span class="task-label">Running</span>
                    </div>
                    <div class="task-stat">
                      <span class="task-count completed">{{ taskSummary.completed }}</span>
                      <span class="task-label">Completed</span>
                    </div>
                    <div class="task-stat">
                      <span class="task-count failed">{{ taskSummary.failed }}</span>
                      <span class="task-label">Failed</span>
                    </div>
                  </div>
                </mat-card-content>
              </mat-card>
            }

            <!-- Quick Actions Card -->
            <mat-card class="dashboard-card actions-card">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>flash_on</mat-icon>
                  Quick Actions
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="quick-actions-grid">
                  <button mat-raised-button class="quick-action" color="primary"
                          (click)="scrollToDeployPanel()">
                    <mat-icon>add_box</mat-icon>
                    <span>Deploy Agent</span>
                  </button>
                  <button mat-raised-button class="quick-action" color="accent"
                          (click)="runSecurityScan()">
                    <mat-icon>security</mat-icon>
                    <span>Security Scan</span>
                  </button>
                  <button mat-raised-button class="quick-action"
                          (click)="viewAnalytics()">
                    <mat-icon>analytics</mat-icon>
                    <span>View Analytics</span>
                  </button>
                  <button mat-raised-button class="quick-action">
                    <mat-icon>terminal</mat-icon>
                    <span>Open Terminal</span>
                  </button>
                </div>
              </mat-card-content>
            </mat-card>
          </section>
        </main>

        <!-- Right-side resources/notifications column -->
        <aside class="side-section">
          <!-- System Health Status -->
          @if (systemHealth) {
            <section class="system-health">
              <h3 class="resources-title">
                <mat-icon [style.color]="getSystemHealthColor()">health_and_safety</mat-icon>
                System Health
              </h3>
              <div class="health-status" [style.color]="getSystemHealthColor()">
                {{ systemHealth.status | titlecase }}
              </div>
              <div class="health-uptime">Uptime: {{ systemHealth.uptime.formatted }}</div>
              @for (entry of systemHealth.services | keyvalue; track entry.key) {
                <div class="service-item">
                  <span class="service-name">{{ entry.key }}</span>
                  <mat-chip [class]="entry.value.status" size="small">
                    {{ entry.value.status }}
                  </mat-chip>
                </div>
              }
            </section>
          }

          <!-- System Resources -->
          <section class="system-resources">
            <h3 class="resources-title">
              <mat-icon>monitor_heart</mat-icon>
              System Resources
            </h3>
            <div class="resource-item">
              <span class="resource-label">CPU Usage</span>
              <mat-progress-bar 
                mode="determinate" 
                [value]="systemStats.cpuUsage" 
                class="cpu-bar"
                [matTooltip]="'CPU: ' + systemStats.cpuUsage + '% | Processes: ' + detailedStats.processesCount"></mat-progress-bar>
              <span class="resource-value">{{systemStats.cpuUsage}}%</span>
            </div>
            <div class="resource-item">
              <span class="resource-label">Memory</span>
              <mat-progress-bar 
                mode="determinate" 
                [value]="systemStats.memoryUsage" 
                class="memory-bar"
                [matTooltip]="'Using ' + (detailedStats.memoryTotalGb - detailedStats.memoryAvailableGb).toFixed(1) + ' GB of ' + detailedStats.memoryTotalGb.toFixed(1) + ' GB'"></mat-progress-bar>
              <span class="resource-value">{{systemStats.memoryUsage}}%</span>
            </div>
            <div class="resource-item">
              <span class="resource-label">Storage</span>
              <mat-progress-bar 
                mode="determinate" 
                [value]="systemStats.storageUsage" 
                class="storage-bar"
                [matTooltip]="'Using ' + (detailedStats.storageTotalGb - detailedStats.storageAvailableGb).toFixed(1) + ' GB of ' + detailedStats.storageTotalGb.toFixed(1) + ' GB'"></mat-progress-bar>
              <span class="resource-value">{{systemStats.storageUsage}}%</span>
            </div>
            <div class="resource-item">
              <span class="resource-label">Network</span>
              <mat-progress-bar 
                mode="determinate" 
                [value]="systemStats.networkActivity" 
                class="network-bar"
                [matTooltip]="'Sent: ' + detailedStats.networkSentGb.toFixed(2) + ' GB | Received: ' + detailedStats.networkRecvGb.toFixed(2) + ' GB'"></mat-progress-bar>
              <span class="resource-value">{{systemStats.networkActivity}}%</span>
            </div>
          </section>

          <!-- Recent Activity Card -->
          <mat-card class="dashboard-card activity-card">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>timeline</mat-icon>
                Recent Activity
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="activity-feed">
                @for (activity of recentActivities; track activity.id) {
                  <div class="activity-item" [class]="activity.severity">
                    <div class="activity-timestamp">
                      {{ formatActivityTime(activity.timestamp) }}
                    </div>
                    <div class="activity-message">
                      {{ activity.message }}
                    </div>
                    <div class="activity-indicator" [class]="activity.severity"></div>
                  </div>
                }
                @empty {
                  <div class="empty-state">
                    <mat-icon>inbox</mat-icon>
                    <p>No recent activity</p>
                  </div>
                }
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Last Updated -->
          @if (dashboardState.lastUpdate) {
            <div class="last-update">
              Last updated: {{ dashboardState.lastUpdate }}
            </div>
          }
        </aside>
      </div>
    </mat-tab>
    <mat-tab label="Tasks">
      <!-- Tasks content will go here -->
    </mat-tab>
    <mat-tab label="Agents">
      <app-my-agents-page></app-my-agents-page>
    </mat-tab>
    <mat-tab label="Boards">
      <app-boards></app-boards>
    </mat-tab>
  </mat-tab-group>
</div>
